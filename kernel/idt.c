#include <idt.h>


IDTR idtr;

void idt_init()
{

	idtr.base = IDTR_BASE;

	isr_setup(0, (void *)exp0_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(1, (void *)exp1_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(2, (void *)exp2_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(3, (void *)exp3_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(4, (void *)exp4_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(5, (void *)exp5_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(6, (void *)exp6_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(7, (void *)exp7_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(8, (void *)exp8_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(9, (void *)exp9_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(10, (void *)exp10_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(11, (void *)exp11_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(12, (void *)exp12_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(13, (void *)exp13_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(14, (void *)exp14_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(15, (void *)exp15_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(16, (void *)exp16_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);

	isr_setup(IRQ_BASE + 0, (void *)irq0_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 1, (void *)irq1_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 2, (void *)irq2_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 3, (void *)irq3_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 4, (void *)irq4_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 5, (void *)irq5_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 6, (void *)irq6_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 7, (void *)irq7_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 8, (void *)irq8_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 9, (void *)irq9_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 10, (void *)irq10_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 11, (void *)irq11_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 12, (void *)irq12_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 13, (void *)irq13_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 14, (void *)irq14_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);
	isr_setup(IRQ_BASE + 15, (void *)irq15_wrapper, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);

	// ascii animation
	isr_setup(ASCII_PLAY_HANDLER_CODE, (void *)ascii_play_handler, IDT_CODE_SELECTOR, IDT_ENTRY_FLAGS);


	// IRQ Mapping
	pic8259_init(IRQ_BASE, IRQ_BASE + 8);


	idtr.limit = (IDT_ENTRY_COUNT * sizeof(IDT_ENTRY)) - 1;
	
	__asm__ __volatile__ ("lidt %0": "=m" (idtr));

	// ascii content
	char *p = (char *)0x200000;
	mcpy(p, "2rZZZaZ88Z800ZWWWBWBWBW@@@M@M@MMM@M@M@MMM@@@@@@@MM@BWWWWWBWBB0B80Z8ZZaZaaZa2a2a72:7XXXX2SSaa2a0ZZ8Z8Z8Z880880W0BBWBWBWBBBBBBBWBWB088Z8888888aa2SS2XXXXX77Xr77;;,araaZaZZZ80Z0BB8@WWBWBWBW@M@@W@W@WMMMMM@M@M@MMM@@BWBWWWBWWB8008Z8ZZaZS2222aSXX2;272aaaZaZ8aZ08ZWB0BWBBWMM@WMWMMMMMMMWWWM@M@M@MMBBWBWBWBWBB00Z8Zaaaa222SSSSSSXSXi2r22aaa2ZZZ80ZBBZ0@00MMr0BW0BBBBBBBX@M@@MMMWBW@BBBWBWBWW0808ZZZaaa2SaSSXZ827XSXiS7222Z2a88Z0ZZ008@0ZMMXS8000B888W@B28aXMWWW@BBBBBBBWBWWB80ZZZa2Z2SSS22XXXSX77X7;S;aSS2aaaaZZZ808BB8@@;XZM@B7ZWM@XW8XMMM@W0WBBBWBWBWBWB88088ZZaaS2S2SXXXXS77XX7X:X722Saaa2aZZZ0ZZBWa@M..MMX0MM22MZ,XMWBBBBWBWBWBBBWBW0080ZZZaaaS22XXSXXXXXX7Xr7X,SraS2Z22Zaa8Za0ZZB8SMM :M7:ZB;XM7,@@WBWBBBBBWBWBW0WB880ZZZaaaS2XSXXXX7X7XXX77;X,X;22SS2aa2a8aSB0X0M2XMM  M@MWMM;.MW8WWBBBWBWBWBBWB8080ZZZZaZSSSXXSX77XrX7;r7;rr,S;a22SZS28aX08X8@Sa@0SMMZMrZ8iMW@BWWB0WWB0WB80@080080ZZaaaa22XXXXXXrXrr7r;r;r;r X;2aSSa2XZaSZ8XZWa2WZZ@W7M2S22MaWW0WB0WWB0BW8BB88088ZZZZ222SXS777777;rrrrrirr:7:S;SS2SSaaXZZXXWZrZMXrMM .M2:78M  M02W@8ZWW88WBZ80ZZZZaa22SSXX7Xrr;rrri;i;riiri;.X;XSS2X2aSSZaaSS80XaM@ 7M@B,,MMM. @@ZBWB808088Z0ZaZZ2Z2SS2XS7X7;;ri;;iii.ii:iri S;SS2X2SXS8X78270S;MW 7MXBMr;MZ0M, 0BS0B80BaZ0Za8aaaa22S2SX7X;r;r:i;i.,ZX::::,; X;XSXXSaXSa7S8rSBXBM :MX.M0..M2,@M  0B0WZZ0Z20ZaZZ2a2S2SXXXXrr;;ii:i::.r;,.;:.r S;SXSXXSXSSXaXiZM ;M72@rXMM  MB;B@ZWB:;B82Z0ZZZaaaa22S2XXXXX7;r;:;i,i:,:::i:::i S;XXXXX2XX2XrZaiX@0rXBXXMB 8a BBXBBaZ@Waa0Zaa8aaaa2aS2SSXXXX7r;r::i:,:,i.,i..;. X;SXSXXS2rX277aXX27X@2:MM iMM  @0XBBZZ8Z88ZaZZaaZ22Z2S2XXSXrXX;r;,:i:,,::,i,,i: 7iXXXSXXSX7SXXXSXX207;MB SMiZM; Z0S80ZZ8Z88ZZ8ZZZa2a22S2XXXX77;r;i::.::,::,:,,, SiSXXXSXXX277SSra2;X7ZM. MM SMW rW2ZZZ00ZZ0ZZZZaZaa2a2S22XXXXr7;i;i::::,:,,::.i SrXXXX7aX72XraXrZZXM@,2MX 82@B SM28MBZZ0ZZZZZ8ZZZZ2a2aSSS2XX7Xrr;;:i:::,.i:.:::.X;SXSXXXX72X7aXrM:i;ZWBMi,:MM rXMai2X0WZ8Z8Z8ZZZZaZaa2a22SXXXX7;ri:i:,i:,:i,ii: 7;SXSSX2X7aS7aX;BM X7;i;i2;7ira77ri;B0a8088088Z8ZZZaaa2aSS2SXXXrrri::i:iii:i,;; XraXa2X2aX2SX2aXS28M0iB08088B0B0BBa0BSBB00B08808888ZZaZZZS2SSXX77;r;i;7iii;iii;,X:X;7X;77;;Xr;;7XXrrSZZa2ZaZ88a8008ZS8Za2aaZaaaa22S2SSXXXX7r;ri;;:.:,. ,,..,.,. \0", 2100);
	p += 0x2000;
	mcpy(p, "S;SX22228Z2Z0aZW82W@2ZMW ZMMW0MM7:M0BW@BBBWBBBBBWW00W0000800008Z8ZZaa2a22a2XSS2rS:;7777X7XSSXaS2Z2S8a28M7i0;Wa7BrZW8Z00880888080Z808ZZaZaZZZaa2SSSXXX7777Xrrrr;,Sr2X2SaaS2022B0X0BaZ@0aWMMMS800MM@0W@BBBWBBBWBWW00W8880800B08aZZZ2aaa2aSSXSSXXSiX;SXS2S2aaSZZ2ZBZa0BaZ@Mi;W7ZZZ8 0MZBW0BBWBB0WW0BW8880808088ZZ2a222222XXXSXX7XXiX;SXXS2Sa2SZZSZ8Za08ZBMr;WM8iSMMS B@8BW0BBB80BBZ0088080008ZaZaaa2S2XSXX72aSrXS7iXrXSXX2SSaa2S08XZW2S@W:rWZWZXSWBM8 8M08W080WB800888080800ZZZaa2aS2SXXS7XXX7X7Xr;Xi2XSXS2SS2aa2ZZ8aaWMXrWZaM872MS8MZ aM88BBB00808080808888ZZaaaaXSXXXS77XX7X77r7:7iXSXXSaS22a2aaZa0@Z 7M8a0MZ,X@8aBMZ XW@0000808080800BZZZZaa22SXXXXSXX7XX7r7;7X:XiXXSX2SXaaXaZSZB,8Z7BaaB8W27rW0B80@BBXi2B8808080808Z8ZZZa222SSXS7XX7X7rX7r7riX:7iXSXXSSXaSXZZr8W;X@Za0B2ZMB:SMZ2WBZBM8ZB08080800008ZZZZaa2aXSSX7X77r7r7r;rrir;,XiXXSXXS2XaSS2Z2S802ZB0SZM8.0iiMZaB0880008080808808ZZZZaaS2SSXX7X77rX;;rriri;r; Xi7XSXXSSX2aX2Z228SXZ0XZMZ SMM ,MZ2W8Z8080008008Z0aZZaaa2SSSXX7Xrrr7;r;;;ri;;:r:XiXXSXXXS2SXa2XXZ2S8Z7ZMX 8WiBM  W0288080000BZZ88aZZa2Z22SSXX7X77;r;r;;i;;i:rii,X;7SXXXXXSXSSXSaSXaB2ZMX ZBa2ZWM  B8ZBB8Z0ZZZZZZZaaa2a2SXSXX7X7;;;i;;i:i.:i::;: XiXXXXSXSXXSSX2SXZ0 ZZZ 8M,XMS;WM  08XXZaa8aZZZaZa222SSXXXX77rr;;:i;:.,2X,::,,; X;XX7XSSXSXXXXSS7SZr8Z8ZZXZZ2ZZ280Z08ZS8aZZZaZaa2a22SSSXXXX7r7;;iii:::.;;:.i,.; XiX7X7S7XXXXSXXX2XXa2X28SXBZ7aBS20Z28ZZaZaZaZ222ZS2SSXXXXXX77rr;iii,i:,,:,:::,: X;XX7X7XXS7XSSXX7SXSaZXXZ2X2ZaSZZa2ZZaaZaZaaaZ2a22SSXSXXXX7XX;;riii:::,i.,i..;. 7iXXX7XXXrXS7;SSX72XrSaXSaa22SZZ22ZZ228a2aZa22a22S222XSXXX77Xr;;;:i::,,:,.:.,:: riXX7X7XXX7X7SX;XX7S2SX22S2aaZa22ZaZZZ2ZZZaaaa2a2aSS2SXSXX7Xr7;;;ii:,:,,,:.,.,: XiXXX7XX7rX7X77X2r;XZXZB2B08BSZZZ08SaaZZZaZaa2a2222S2SXXX7XX7r7;;ii::,..:.,,,.: X;7XX7XSrXXr7S7X7XWW:802 i::,.r8ZXaW88ZZZa2aaa2a2222S2SXXSXX77rr;;ii::,:.:,.::, XiXXX7S77SX;aX,aM.77 i:.MB88WMi.X;;X:Z0SaZa2ZZaaaSa22S2SSXX7X77r;;iii,::,::,::, 7;XXX7XX7SX7SX;W7 rX:8MSS2SaZZ2MB,2SiiZaaZaZZZ2Zaaa222SSSXXS7X77rrii:::::i,::ii 7;S7SSSXXSS7SSXXa0B0Z2SXZZZaZaZaZ8@WW0Za8ZZZ8ZZaZaZaa222aSSXXXX77;r;i;r:iiiiiii.X:7;r7;7rrrrrrr;7ri7XXX2SXXSX2S2ZZX22a2aS222S2S2SSSSXSXX7X77;ri;;i,::,.:,..:.,, \0", 2100);
	p += 0x2000;
	mcpy(p, "S;2a2Saaaa0ZZB0a0B8aWB00@MMSaZBMM00W@@WBWB0BWBWBWBWB0800000B8Z88ZaZZ22a2a2SXSS2rS,rX7XXXXXSaS2Z2X88280XBai0SZ8a8788B080B0080808080ZZaZZZZZZZZaXSSX7X7X77rX;rr;i,SrSS222S8ZS0BS8W08@ZSM7;@BM2S8B0M0;Z08W@W@@BBWWZWB80000000BZZZZ2Za22aSSSSXSXXXX;SrS2X2aS282Z8Z08r0aM:ZM@Z8M0Xa@80@MMXSZZ0a0WBWB0WB80800000ZZaZZ2S2SX2SXXXXSX7XXiS;SS2SaS2aaZZ20028rBMZZBB8M8r2M8BW80MM020aBBBBB0080808B80ZZZZaaSSSSXSXS72ZSrXXr:XrXXS2S2Z2S8aa8aZW0a000BZ8MZrSW88@BWB0B@WW0B8B0880800000ZZZZa2S22SXSXXXX7XXr7Xri7;SXXS2SaSZZS2BaZBZZBZaB08M0rXM00W88W0BW08W088080800008ZZZaa2S2XXXSX77X7X7r777X,XrSSXS2S2ZS2ZZS200S80Z8BZaM0:XMZZ@00BB80B0008080808B0ZZZZa2aSSSSXSXX7X777rr7;rX.X;SXXS2S2222ZSa8a2B0aaB8ZWMXS;B@Z0B880B8080808080088ZaZZZ22SSXS7XXX7Xrrr7rr7r;7,7;SSXXX2S22ZS28ZX802Z@a2@M .M0 2Ma8B800080800000808ZZZaaa2S2XSX77Xrrr7rX;;;;ir;,X;2XSXS2SSaSSZaX08XaW22MM :WaMZ SMZZB0880088080B8ZZZaZa22SSXSXX77r7r7;;;;;;;;;; 7iXSXXS2X2SSaaXZZXaWZSBW ,MB70MZ XWZ8B8Z0B8Z00Z8ZZZZ2ZaSSSXXXX77rrrri;;;;rir;,r:XiXXSXSXX2SX2XSZSXMa 0W ,M7SM2XM0 i@ii88Z80a88ZZZaaa222SSXXXXr7rr;;;;i;:i;ii;:i.Xi7SXXXXX2XX2XXZ2XaZZMi:W87ZB8S8MX ZB08Za8ZZZZZZaaaaS2SXXS7X77r;;;iiiiii.:i,,;: XiXSXXSXXSSXSSXX2a2S2SBMSrW8rZWX2W@ZZ88Z8ZZZZaaaZ2aS2SSXSX777;;;i:iii.,aX,,::,r 7;XX7XXSXSXSXXSXXSX2Z27Z8aaZZ8ZZZ82a0ZaZZZZZaaaa2222SSXX7Xr7;;;iii::,:.;;,.;, ; XiX77XS7SXSXX7XXS2aXXaZXaa22Za2aZaZZZ2ZZZaZaa2a22S2SSXXXX7Xrririii:,i:,,:,:,::: 7;XX7X7XSS7XXXXSXXS2XSaa2ZaZ2ZZZ2ZZZZZZaaZ2a2Zaa2SSSXSXX7Xr7r;;r:::,,:,i.,i..;. XiXXXXXXX7XXXrXXSSXX2SXX2222Z222ZZaaZaZaZ2aaaaa22S2SSXSXX7Xr7r;;i,:::,.,:,:,,:, riXXXS77XX777SX7rSSSXSS2S2aaSaZZaZZZZaaZZZaZaaa2SaS2SSXSXXX7r7;;;:::::,,::,:,,: XiXXX7XX7rXXXr7X27rS8aZZ8ZZZ08880002ZZ8aZaZaa2aaSS2SSXXXSXX7rrr;;::::::,:,::i.: Xi7XX7XSrXSr7SX772@Wi822Z2ZZ2Z2ZZX2M08aZZZ2Zaa2Z2222S2XXSX7X77r;ii::,:::,:,.::: XiXX77S77SX;aX:aM.77 i;::iii;i;;XiiX:ZBSaZZaZZaaZSa2SS2XSXX777ri;ii::,i:,,:,::: X;XX77SXrSX727;@7 7X:ZMZ0@0BWBBM0:22;:ZaZZZZZZaZaa2aS2SSXSSX7Xr7r;ii:i::ii,i:i; X;SXSXSSXSS7SS7X20W0ZaXrZZS28a2ZZ0@WW0ZZ8ZZZZZZZZaZ2a2a22XSXXXXrr;r;ii;:i;;ii:;,7:7;r7i7r;r7;rr7rr;7XXXaXXSSSa2222S22a2a22S22222SSXSXS7X77rri;;ii:.,:..::..:,,: \0", 2100);
	p += 0x2000;
	mcpy(p, "2raaa2ZZaa0ZZB0aBB8aWWBBWMMZaZBMMBBW@@WWWBBBWBWWWB@0000000BBBZ888aZZa2aaZa2S22a7Si7XXXXSSSSZS28aS88a0BXBai02Z8ZZXZ8B000B000B800000ZZZZZZZZZZaaS2SSXX7XX77Xr77rr:272S22a20Z20BS8WB0M8SMX7@WMaS8WBM0rZ0Z@@W@@BBWW8WB0000B0B0B8Z8ZaZZaaa222SX2SXX2;S7SaSaa2a8aZ8ZB8r0aM;ZM@88M8XaW80@MMSaZZ02B@BWBBWB00000B0088ZZZa2Z22a2X2SSSSXSX;2rS22Sa2aZZZ8a00a8X0@ZZBB0M072@8WW00MM0ZBZWBBWB008000000BZZZZaZ2a22X2SSX2Z27XXXiS7SSSaSaZ228Za0aZ@0a0B0BZ8MZ72W88@BWB0BMWW0B8B0000000000Z8ZZaa2222X2SSSXXXX7XX7;Xr2SSSa2aSZZS2BZZBZ8WZZB00M87SM0BW08WBBBB8WB00080000BB0Z8ZZaaS2SSS2XXXXXX7X777XiX7SSX2222Z2aZ82aB0200Z8BZZM0iSMaZ@00BB8000800080000B08ZZZZaZ2a2SSSXXXX7XXX7XrXX:Xr2SSSa2aa2aZ2Z8aaWBZZB88@MX2r0@Z0W00BB80000000000B08Z8ZZaa2aSSXXXXXSX77XXXX7rX:Xr2SSSSa222Z2a8ZS0028@Z2@M.:MB 2MZ0W0080000000008B0ZZ8ZZZa2aSSSXXX7X7X7Xrr77;7r:Xr2SSS2222Z22Z2S08SZW2aMM.;WaM8 SM8ZB0000000B0BB8Z8ZZZaaa2aSSSX7XX7rX7r77;rrrr7.X;S2SS22Sa2SaZXZ8SZWZ2WW iMBX0M0 XW88B088B0800Z8ZZZ8aZa222SSXX7X777r;7rrrr;rri7iS;XSSS2SS2SSaS2ZSX@a BB iM72M2XMB i@;iZ8Z0BZ88ZZ8aaaa2aS2SXXX7X7r;rrriri;r;i7i;,X;XSSSSSSaXSaSSZ2Sa88M;;W0X8B828M2,ZW008Z88ZZ8ZZZaZa2aSSSSXX777rr7i;;;i;:iiiiri X;XSSX2SS22X22SSaZ222SBMS7@ZrZ@S2W@ZZ88Z8ZZZ8ZZZaaZ2a2SXSXXX7;r;;i;;i,:ZX:i;::r XrXSXXS2SSSSS22SX2SaZa7a8ZZ8Z8ZZ08aZ08aZZZZZaZaa2222SSSSXXXXrrr;i;ii:i,rr:,;:.r.X;XXXXSXSXXX2XSSS2aSSZZSaZ2a8aaZZaZZZaZZZZZaZaa2a22SSXSXXXX77rr;;ii:;:::i:i::ii XrXXXXXXXS7XXSS2XXSaSS2a2ZaaaZZa2ZZZZ8ZaaZaZaZaa2222SSSXXX7X7rr7:ii::::;,,;,,r. X;SXXXXXXXXXX7XXS2SXa222Z22aZaZZZZZZ8ZZZZaZaZaa2a2222X2SXXX7Xrrrr:i::::::,i,,i: 7;XXXSXXSS7XXXXXXSSSXSS2S222SZaaaaZZaaZZaZZZaZa22Z2a2SS2XXXX7Xrr;iii,:::::::::: S;XXX7XXXrXXXrXXSXXXSXSSSS22a2a2ZaaaZZZaZaZaZaZa22a22SSSSXXXX7rrr;ii:::::::,:.i Xr7XXXXSrXSrr2X;XZ80Z0008080000B0BBWB8aZZZ2aZZ2Zaa22SaSSSS7XX7r7;;ii::,:.i,,:::.X;XXX7SXXXX;aX:2M.;7S;XX7SXXS72XSSSXiZ0aZZZaZZaaZ2Za222SSXSXX77rr;;ii,::,::,::, X;SSXXXX7XX7SX;W7 XS;S77XXSXX2XSSXS2riZZZZZZZZaZZaaa2a2SSSSSXS77r7;iii::ii:i,i; XrSXSXSXXXS7XSXXaBBZ0B88W00BB00BB0WBW0ZZ88888ZZZZZZZaaaa2SSSSXXr7r7rii;iii;ii;;.7:7;r7;r;;;r;r;r;;;rX7;7XXSS7X22SS2a2Zaa2aaa2a2aSSS2X2XX7777;r;;;i,::. ,,....,. \0", 2100);
	p += 0x2000;
	mcpy(p, "S;222S22ZZZ2Z000000ZMM: M8 8MMi M@.Z@8BBWBBBBBW0BW08W8080000ZZZZZaa2aS22a2SXSSSrX:rX777XXSSSa2SZZZZ2SMB 7M,;S8rSB7r000008B008088Z0ZZZZaZaZZZ22SSXX7X7777r7;rr;;,SrS22XZaSZ828Z8WZXWMSaM8.ZMW@8@MXi@WBW@WB8W@W0BW08W80808080ZZZZ2Z2222SXXXX2XXXXiXrXaXSZ2X02X0WiZW80r8W0700B;WZXWZ202XB2X07 ZW8Z@080080800ZZ8aZa222S2SXXXXXXX7X7iS;X2XXaS2aSa@;.W2:MXXB08WMZ70aXM0BMaXW0XBMSa@80B88080808BZZZa2aS2S2XXXXr2ZSrXX7iXrXSXSSS2ZX2BaSWZSZB8880ZWWXX2ZB80B@WBB@B0B@0888888080Z88aZZa2S2SXXXXX777X777X7iXiSXXX2SS2ZS20Z78WSaBZZBZ2M0rSM28W88WB0BB8B0880808080ZaZZ2Za2S2XXXX7X777Xr77rrX,XrXSXXX22Sa8XS0Z20ZZBZaWZ8MZ:X@ZZB88008088Z8808880808ZaZa222S2XXXS7X777Xr7r7;rX,X;SXS2XXZ2SaZ2a220ZS0800aZMa;rW888080888080888080808ZaZaa22SSXSX77X77rrrr7rrr;r,7iSSXSSSS2Sa2SaZ2Z2ZBZX000MZ ;@88B8880008080808008ZZaZaaa2S2XXXX7Xr7r7r7;r;;;r;,Xi2XXXXS2S2222ZS2BWS20W@2iWX2SB;7BB00ZZ0WWB0000Z0ZZZa2a22S2XXXXr77r;7;;rrir;;;; 7;XSXXXXS2SSSaS2Wr.WZ0 28i80aMW7Z2:2WZ0W;;80ZB8aZZaZ2a2SS2XXXX77rr;r;;;i;r:;;,;:XiXXSXXXXX2SXa2rBB  Mr Z0XB8Z0Z8@ZZ0iiBr XB2a0Z28aaa2S2XSSXXXrrr;i;;;i;:i;i:;:i.Xi7XXSXSXXSa7X87i@@ 2Ba0Sa0aS88Z8Z808W2,X@SS88XZZS2ZS2SXXX7Xr7r;iriii:ii.:i::;: XiSX7XXX2X722;SZX7Z08SSZZaa288aa0Z88Za8BBZaZ8X282XZ2XSSXSX777;ri;iii:.,aX,,i:.; 7iXX7XSrX27722rX22XS22aZS2aa2ZaZaZaZZZZZaZZaS2Z2Xa2XS2XXX777;;;;:::i,,.;;:.i: ; XiX7X7XX7XSX7XSXXS2S2S22a22aZZZ2aZZaZZZaZZa2Za2XZ2XX2X7SXrXrr;;iiii,::,,:,::::: X;XXXX7XXX7SSXXXXXXSX2S222Sa22aZaaaZaZaZaaaaa22aSSS2XXXX7X777;;r::::::.i..i..;. 7iX777X77XX7X7XXXXXX2S2S2222ZaZ2aaZaZaaaaaa2a2aS2SSSSXSXXX7r7;;;i,:,:,,::,i,,i: r;XX7X7XXXrXXX7X7XXSXXSSS222Saaa2ZaaZZaZZZa22a22S2SSSXXSX777r7;;;i::::,,,:,,,,, XiXXX77XXrXX7rXXX777XXSXSXSS2222aSaaaaZZaaZaa2a2S22SSSXXS7XX7rr;;:i,::,.:,,,:.: X;7XX7XX;XSrrSX;7Z88Z0808080008000BB082aZZSaaa2Z2222S2SXXX7X7r;;ii::,:,,,i,,::,.XiXXX7XX7X7;2X,SM.irX;X7rX77S7SXXSSX:Z02aZa2Zaa2aS222SSXXXX7777i;ii:i,::,:i.,:, 7;XXXX7X7X77S7;Wr rXi7rr77XX7SXXXXSS;:ZZaZZZZZaa2a22S2XXXSXX77rrr;i::i:::i:::ii 7;S7SXXXXXXrXSXX20B88008B000B00BB0BWW0ZaZZ8ZZaZZZ2aaa2222XSXX7Xrr;7;:i;iiiiiii;.7:7ir7ir;;rr;;rr;r;7r7r7XX7XXSX2S2SaS222S2S2S2S2XSSXXS7777rri;iiii.:,. ,:  :.,, \0", 2100);
	p += 0x2000;
	mcpy(p, "2rZZZ2Z80a0008BWWWWBWBW@@@M@M@M@M@M@@@M@@@M@@@M@MM@BWBWBWW@B00B8888ZZaZa2Za2a2ar2:7XXXX2SSaa2Z0ZZ888Z8Z8Z080BW0BBWBBBWBWBBBBBBBWBB8888Z88088Za2SS2XXXXX7rXr77r;,a72aZaZ888080B08WWWBWBWBWW@@@@@@@@MMMMM@M@MMMMM@WBWBWBWWWWB8008Z8ZZZaS222SaSSS2;272aaaZaZ8a808ZWB0BWBWWMM@W@WMMMMMMMWWWM@M@M@M@BBWBWBWBWB000Z8Zaaaa222SSSS2SXSXi2r22aaa28ZZ80ZBWZ0@00MMrBBW0BB0BBBWXWMWWM@M@WW@BBBWBWBWB080ZZZZaa2aS2SS7a8a7XS7iS72S2Z2aZ8Z0ZZ888@0ZMMXS8080B0Z8W@B28ZXMWWW@BBBBBWBWBWW0Z0ZZZZaa2SS2SSXXXSX77XX;XraSSaaaaaZZZ80ZBB8@@;XZM@BXZWM@XW8XMMM@W0WBBBWBWBWBW00808ZZZaZSSS2XXXXXS7XXX7X,X722Saaa2ZZZZ0ZZBW2@M..MMXBMMS2MZ.XMWBBBBBBBBWBBBWBW0088ZZZZ2aS22SXSXXXX7X7Xr7X,XraS2a22ZaaZZ20ZZW8SMM :M7:ZB;XM7,@@WBWBWBWBBBWBW0WB880ZZZa2a22XSXXXX7X7XXXX7;X:X;22SS2Zaaa8a200X8MaXMM  M@MWMMr.MW8WWBWBBBWWWBWWBZ080ZZZaaZSSSX7SX77XrX7rr7;7r,S;aSSSZS2ZaX08XZ@SaM0SMM8MrZ8iMW@BWWB8BBBBWB80@000080ZZZaaaS2XXXXXXr7r;77;rrrrr X;S2SSaaXZaSZ87ZWa2WZa@B7M2SSaMaWW0WB0BWB0BW0BB880Z8ZZaa2a2SXS7X7777;rrrr7irr:riS;X22SSaaXZZXXWZrZMSrMM .M2:78M  M02W@8ZWW88W0880ZZZZ2a22SSSX7Xrr;rrri;i;riiri;.X;XS22X2aSSZaaS2Z0XaM@ 7M@B:,@MM. @@ZBWBZ08088Z0ZaZZ2ZaS2SXS7X7;;ri;;iii.ii::ri X;SS2X2SXS8X78270SrMW 7MXBMr;MZ0M. 00S00800ZZ0Za8aaaa22S2XXXX;r;r:i;i.:ZX,::i:; X;XSSXS2X2a7SZrSBXBM :MX M0..M2,@M  0B0WZZ0Z28ZaZa2aaSS2XXXXrr;iii:i::.r;,.;:.r SiSXXXX2XSSXaSiZM ;M7aMrXMM  MB;B@ZWB:;B82Z8ZZZ2Za222SSSXXXX7;r;:ii,i:,,i,::::i SrXXSXX2XX2XrZaiX@0rXBXXMB 8a BBX0BZZ@WZa08aZZaaaaaaS22SXXXX7r;r::::::,i.,i..;. X;SXSXXSSrS277ZXX27X@2:MM iMM  @0XBBZZ8Z88Za8ZaaZ22a2S2XXSX7X7;;r::::,,,,:i.,i, 7iSSXSXXSX72XXXSXX207;M0 SMiZM; Z0S80ZZ8888ZZZZZaa2Z2SS2XXXX77;r;i:i.i,.::.::,: SiSXXXSXXX27r2SrZ2;X7ZM. MM XMW ;WaZZZ08ZZ0ZZZ8Zaaa2a2SS2XXX777;;ii::,:,:,,::.i SrXSXXX2X72XraXrZaSM@,2MX 8a@B SM28MBZZ0Z8ZZZZZZZZ2aaa2S2SXXXXr;;;::::i,.i:,::,.X;SXSXXSX7277aXrMii;ZBBMi.:MM rXMai2X8WZ888ZZZZZZaZaa2a2SSXXXX7;riii:,i:,:i,ii, 7rSXSSX2X72S7aX;B@ Xr;i;i2;7;ra77;i;B0a8088088Z8Z8Zaaa22S22SXXXrrri::i:iii:::;; XraX22X22XaSX2aXSa8M0iBB8088B0B0BBa0BSB000B00808888ZZaZZZS2SSXX77;7;i;rii;;;ii;.X:X;7X;77;;Xr;;77Xr7X8Z22ZaZ88a8008ZS88aaZaZaZaa22S2S2XX7X7r;r;;;:.::. ,,,.:,,, \0", 2100);
}


void isr_setup(u8 idt_index, void *callback, u16 selector, u8 attribute)
{
	IDT_ENTRY *IDT = (IDT_ENTRY *)idtr.base;

	IDT[idt_index].offset_low = (u32)callback & 0xffff;	
	IDT[idt_index].offset_high = ((u32)callback >> 16) & 0xffff;
	IDT[idt_index].segment_selector = selector;	
	IDT[idt_index].attr = attribute;
}

void _exception_dispatch(IDT_EXP_CONTEXT *exp_context)
{
	xprintf("the ISR number = %d, ERROR no = %d\n", exp_context->isrno, exp_context->errorno);
	xprintf("the segments cs = %d, eip = %d\n", 
		exp_context->cs,
		exp_context->eip);

	puts("Kernel Exception, System Halt.\n");
	for (;;);
}


void _irq_dispatch(IDT_IRQ_CONTEXT *irq_context)
{
	// xprintf("the IRQ index = %d\n", irq_context->irqno);
	// xprintf("the segments cs = %04d \n", 
	// 	irq_context->cs);

	switch (irq_context->irqno) {
	case 0: 
		timer_handler();
		break;
	
	case 1:
		keyboard_handler();
		break;

	case ASCII_PLAY_HANDLER_CODE:
		// ascii_play_handler();
		break; 

	default:
		;
	}

	_send_eoi(irq_context->irqno);
}


